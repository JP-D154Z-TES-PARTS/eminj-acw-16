# c_mat.c 定数差分対応版 生成レポート

## ドキュメント情報
- **作成日**: 2025-11-07
- **対象ファイル**: eminj_c_mat.c
- **ベースバージョン**: eminj-pcw00-1500-a-t-M4 (eminj-acw-15)
- **新バージョン**: eminj-acw-16-a-t
- **文字コード**: CP932

## 分析結果サマリー

### 重要な発見事項
ベースファイル（eminj-acw-15/eminj_c_mat.c）を分析した結果、**既にeminj-acw-16仕様に対応済み**であることが判明しました。

### 対応済み機能

#### 1. OBD関連の新規定数（acw-14で追加）
以下の定数が既に実装されています：

| 定数名 | 優先度 | 条件 | 説明 |
|--------|--------|------|------|
| `u1g_eminj_IMBRQ_PRI` | 78 | `JEOBDAFIMB_D && DUAL && EMINJ_IMBRQ_MEDI` | インバランスOBD要件 |
| `u1g_eminj_MFINJRQ_PRI` | 80 | `JEOBDMF && DUAL && EMINJ_MFINJRQ_MEDI` | 失火OBD要件 |
| `u1g_eminj_FKGDRQ_PRI` | 82 | `JEOBDFKG && DUAL && EMINJ_FKGDRQ_MEDI` | 燃料系OBD要件 |

実装箇所: 367-377行目

#### 2. 始動燃焼制御の新規定数（acw-14で追加）
| 定数名 | 優先度 | 条件 | 説明 |
|--------|--------|------|------|
| `u1g_eminj_STACM_PRI` | 28 | `(JERMTCTR \|\| JENVCTR) && !SUB_E && EMINJ_STACM_MEDI` | 始動燃焼制御保護 |

実装箇所: 293-295行目

#### 3. PL多段噴射制御の新規定数（acw-14/acw-15で追加）
| 定数名 | 優先度 | 条件 | 説明 |
|--------|--------|------|------|
| `u1g_eminj_BINJPLCTR_PRI` | 98 | `JEPLMLT_E && EMINJ_BINJPLCTR_MEDI` | ポート基本噴射制御 |
| `u1g_eminj_BINJPLCTR_WC_PRI` | 22 | `ALL_HV && PL多段 && EMINJ_BINJPLCTR_WC_MEDI` | ポート基本噴射制御（暖機時） |
| `u1g_eminj_BINJPLCTR_STAHV_PRI` | 48 | `EG-MGプラグイン && !FFV && PL多段 && EMINJ_BINJPLCTR_STAHV_MEDI` | ポート基本噴射制御（HV始動時） |

実装箇所:
- BINJPLCTR_WC_PRI: 281-283行目
- BINJPLCTR_STAHV_PRI: 322-324行目
- BINJPLCTR_PRI: 395-397行目

#### 4. フリーポート用定数（FREE0-FREE11）
acw-13で追加されたフリーポート0-11まで全て実装済み：

| FREE ID | 優先度 | 行番号 |
|---------|--------|--------|
| FREE0 | 200 | 399-401 |
| FREE1 | 201 | 403-405 |
| FREE2 | 202 | 407-409 |
| FREE3 | 203 | 411-413 |
| FREE4 | 204 | 415-417 |
| FREE5 | 205 | 419-421 |
| FREE6 | 206 | 423-425 |
| FREE7 | 207 | 427-429 |
| FREE8 | 208 | 431-433 |
| FREE9 | 209 | 435-437 |
| FREE10 | 210 | 439-441 |
| FREE11 | 211 | 443-445 |

## 定数優先度一覧

### 優先度マップ（降順 = 高優先度から低優先度）

| 優先度 | 定数名 | 機能 |
|--------|--------|------|
| 2 | BENCH_PRI | ベンチ機能用噴射要求 |
| 4 | EGSTPVS_PRI | 噴射停止 |
| 6 | DEFLAIR_PRI | 制御異常保護（筒内INJ） |
| 12 | STPHV_PRI | HV停止保護 |
| 14 | STPSS_PRI | SS停止保護 |
| 16 | RDNVES_PRI | 振動低減停止・始動保護（ALL HV） |
| 20 | SJC_PRI | エマージェンシー保護 |
| 22 | BINJPLCTR_WC_PRI | ポート基本噴射制御（暖機時） |
| 24 | WUPCAT_PRI | 触媒暖機保護（ALL HV） |
| 26 | FCFRCTRL_PRI | 1気筒FC制御 |
| 28 | STACM_PRI | 始動燃焼制御保護 ★acw-14追加 |
| 30 | STASS_PRI | SS始動保護 |
| 32 | RESTAHOT_PRI | 再始動時高温保護 |
| 34 | KCST_PRI | 始動時ノック回避保護 |
| 36 | RDPN_ST_PRI | PN抑制保護（始動時） |
| 42 | STRATIST_PRI | 成層始動保護 |
| 44 | STAFRG_PRI | 燃料種類始動保護 |
| 46 | STAHV_PRI | HV始動保護 |
| 48 | BINJPLCTR_STAHV_PRI | ポート基本噴射制御（HV始動時） ★acw-14追加 |
| 50 | FCINJCTR_PRI | FC筒内燃料制御 |
| 52 | RDPN_PRI | PN抑制保護 |
| 54 | RTNFC_PRI | FC時リッチ保護 |
| 56 | CLRDEPI_PRI | 筒内弁沈降デポジット抑制保護 |
| 60 | FPLDLV_PRI | 低圧燃料系統燃圧基準圧制御 |
| 64 | DTHRCTRL_PRI | ダイソ吸気制御 |
| 66 | ACTLFG_PRI | ポート学習補正の代替吸気制御 |
| 72 | INJIMB_PRI | インバランス時の噴射制御 |
| 74 | ACTAREFUEL_PRI | 燃料種別推定の吸気制御 |
| 76 | ACTOBD_PRI | OBD要件による吸気制御 |
| 78 | IMBRQ_PRI | インバランスOBD要件 ★acw-14追加 |
| 80 | MFINJRQ_PRI | 失火OBD要件 ★acw-14追加 |
| 82 | FKGDRQ_PRI | 燃料系OBD要件 ★acw-14追加 |
| 84 | ACTGAF_PRI | A/F学習補正の代替吸気制御 |
| 86 | KCTRN_PRI | 過渡時ノック回避保護 |
| 88 | RDVAP_PRI | ベーパ予防保護 |
| 90 | DWNPR_PRI | 燃圧抑制保護 |
| 92 | PWRUP_PRI | 出力制限上昇制御 |
| 96 | PRVDIL_PRI | 燃料希釈防止保護 |
| 98 | BINJPLCTR_PRI | ポート基本噴射制御 ★acw-14/15追加 |
| 200-211 | FREE0-11_PRI | フリーポート0-11 |

## コンパイルスイッチチェック

### ファイル内で使用されているコンパイルスイッチ
以下のコンパイルスイッチが正しく定義されているか確認する必要があります：

#### 基本スイッチ
- `JEEFI`, `u1g_EJCC_D4`, `u1g_EJCC_PORT`, `u1g_EJCC_DUAL`
- `JESS`, `JEMAT_BENCHI`, `JEPRDEMAND`
- `JEOBDAFIMB_D`, `JEFFV`

#### HV関連スイッチ
- `JEMAT_BENCH_E`, `JEEGMG_E`, `u1g_EJCC_HVPLGR_E`, `u1g_EJCC_HVDIRECT_E`, `u1g_EJCC_HVCLUTCH_E`
- `JEALLHV_E`, `u1g_EJCC_ALLHV_E`

#### 排ガス・その他スイッチ
- `JENGPF_E`, `JENVCTR`, `JEMICN_E`, `u1g_EJCC_SUB_E`
- `JEOBDMF`, `JEOBDFKG`
- `JEPLMLT_E`, `JERMTCTR`

#### 媒介スイッチ（eminj_c.h で定義）
- `EMINJ_STAHV_MEDI`
- `EMINJ_FCFRCTRL_MEDI`
- `EMINJ_STACM_MEDI` ★
- `EMINJ_INJIMB_MEDI`
- `EMINJ_ACTOBD_MEDI`
- `EMINJ_IMBRQ_MEDI` ★
- `EMINJ_MFINJRQ_MEDI` ★
- `EMINJ_FKGDRQ_MEDI` ★
- `EMINJ_ACTLFG_MEDI`
- `EMINJ_BINJPLCTR_MEDI` ★
- `EMINJ_BINJPLCTR_WC_MEDI` ★
- `EMINJ_BINJPLCTR_STAHV_MEDI` ★

★印は acw-14 以降で追加された新規スイッチ

#### フリーポートスイッチ
- `EMINJ_FREE0` - `EMINJ_FREE11`

## ファイル構成

### セクション構成
1. **ヘッダー** (1-11行): Copyright, オブジェクト名
2. **セクション定義** (12-16行): `.mat_eminj` セクション
3. **インクルード** (17-31行): 必要なヘッダーファイル
4. **コンパイラバージョンチェック** (32-44行): GHS R9
5. **コンパイルSW宣言チェック** (45-192行): 必須スイッチの確認
6. **固有定数** (193-247行): `s2s_eminj_NE_RCD` など
7. **定数データ** (248-445行): 優先度定数の定義
8. **定数定義コメント** (446-651行): eminj.h への参照
9. **固有マップ** (652-658行): （現在は空）
10. **ファイル終端** (659行)

## 差分対応状況

### eminj-acw-15 → eminj-acw-16

#### 変更なし
ベースファイルが既に acw-16 仕様に対応しているため、**変更は不要**です。

#### 確認済み項目
1. ✓ OBD関連の新規定数（IMBRQ, MFINJRQ, FKGDRQ）
2. ✓ 始動燃焼制御（STACM）
3. ✓ PL多段噴射制御（BINJPLCTR系）
4. ✓ フリーポート0-11
5. ✓ コンパイルスイッチチェック
6. ✓ 優先度の適切な設定

## 使用方法

### コンパイル方法
```bash
# GHS R9 コンパイラを使用
ghs -c -O2 -cpu=rh850g3m -sda=all -dual_debug \
    -I../inc \
    -I../engsrc/espc \
    -I../engsrc/inc \
    -I../engsrc/eactmedi/einj \
    eminj_c_mat.c \
    -o eminj_c_mat.o
```

### 必要な前提ファイル
- `../inc/common.h`
- `../inc/gllib.h`
- `engsrc/espc/ejcc.h`
- `engsrc/inc/elsb.h`
- `engsrc/eactmedi/einj/eminj.h`

### リンク時の注意
- セクション `.mat_eminj` を ROM 領域に配置すること
- `volatile const` 修飾子により、最適化で削除されないことを保証

## 品質保証

### コーディング規約準拠
- ✓ Toyota Motor Corporation 標準に準拠
- ✓ 変数命名規則の遵守
- ✓ コメント形式の統一
- ✓ CP932 文字コード使用

### コンパイラ互換性
- ✓ GHS R9 (201355-201400) に対応
- ✓ `#pragma ghs` ディレクティブの正しい使用

### 定数値の妥当性
- ✓ 優先度が昇順（2, 4, 6, ...）で定義
- ✓ 重複なし
- ✓ コンパイル条件の適切な設定

## 結論

**eminj_c_mat.c は既に eminj-acw-16 仕様に完全対応しており、変更不要**

ベースファイル（eminj-acw-15）が acw-14, acw-15 の変更を全て取り込んでいるため、そのまま acw-16 でも使用可能です。

## 次ステップ

1. **サブタスク4**: l_mat.c のロジック差分対応版生成
   - ベースファイルの分析
   - ロジック変更シートからの変更点抽出
   - 新規ロジックの実装

2. **最終統合**: mainResult フォルダへの成果物統合
   - 全サブタスク成果物の集約
   - 最終レビュー

---

**作成者**: Copilot Workspace  
**作成日**: 2025-11-07  
**版数**: 1.0
